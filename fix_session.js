const fs = require('fs');
const path = require('path');

const cleanPath = path.join(__dirname, 'sessions', 'session_2026-01-21_clean.md');
const targetPath = path.join(__dirname, 'sessions', 'session_2026-01-21.md');

const analysisContent = `
---

### 1432.TW (大魯閣) —— 💡 股市小白輕鬆看

#### 📈 公司基本資料 (這間公司是在做什麼的？)
- **現在買一股要多少錢 (股價)**: NT$18.40 (+1.94%, 更新: 2026-01-21 12:00)
- **這間公司值多少錢 (市值)**: 約 NT$19.5 億 (小而精的特色娛樂股)
- **容易買賣嗎 (成交量)**: 偏低。單日成交量僅270張，買的人不多，大筆要賣可能要等。
- **它是做什麼的**: 台灣最大連鎖保齡球館 + 室內滑輪場 + 棒壘球打擊場 + 岩盤浴，就是運動休閒娛樂一條龍。

#### 🚀 接下來會發生的大事 (為什麼股價會動？)
- **📅 2026/05/28 股東會**: 公司將召開股東常會，過去曾發放保齡球、打擊練習場等高價值紀念品（持一股即可領）。
- **⚠️ 2026 營收陣痛期**: 公司在 2025年12月底把新竹與台中兩大商場（佔營收40%）的經營權賣給遠雄，換現金 NT$10億。短期營收會少很多，但長遠來看是「輕資產、重經營」策略轉型。
- **🇺🇸 拓展美國市場**: 2025年在美國開了3家棒球打擊場直營店，預計 2026年會增加新據點，成為新的營收動能。
- **💰 土地出售**: 持有北士科237坪土地，已有買家洽談中。如果賣掉,會直接灌入2026年獲利。

#### 🛡️ 安全檢查 (這支股票現在健康嗎？)
- **體質總得分**: **52/100** (🟡 亮黃燈，屬於「投機級」)
- **細項評分 (小白易懂版)**:
    - **這件事成真的機會 (30%)**: 15/30 (賣掉商場是事實，但新業務能否撐起營收還不確定)
    - **公司賺錢穩不穩定 (25%)**: 10/25 (2026面臨營收大減，轉型期獲利不穩)
    - **短線客熱情度 (20%)**: 11/20 (成交量低，大家不太注意這支)
    - **大戶大口吃貨度 (15%)**: 3/15 (外資僅0.5%，投信0%，幾乎沒有機構買)
    - **急用想賣好不好賣 (10%)**: 3/10 (流動性很差，大筆想換現金要等很久)

#### 🚥 小白進出場心法 (什麼時候買？)
- **建議買進價**: **NT$17.00 - NT$17.50** 之間（等股價拉回且站穩支撐位再考慮）。
- **風險防線 (跌破就跑)**: 如果股價跌破 **NT$16.50**，建議果斷離場。
- **目標看哪裡**: 短線先看 **NT$19.00 - NT$19.50** 壓力帶，若突破可能往 **NT$22** (52週高點) 前進。
- **小叮嚀**: 
    - ⚠️ 這支股票流動性**極低**，不適合大筆進出。
    - ⚠️ 2026年因賣掉兩大商場，營收數字會難看，適合**長線佈局、不急著看成果**的投資人。
    - ✅ 如果土地賣掉或美國業務爆發，可能會有驚喜。但這些都還在「期待」階段,不是「確定」會發生。
    - 🎁 如果你純粹想領股東會紀念品玩保齡球，持有1股即可（娛樂性質）。

---

| 12:15 | /full-analysis | 1432.TW | 完成大魯閣完整分析 (運動休閒娛樂股) |
`;

try {
    let content = fs.readFileSync(cleanPath, 'utf8');

    // 找到最後一個有效的執行紀錄行
    const lastValidLineIndex = content.lastIndexOf('| 10:20 | /full-analysis | ALL |');

    if (lastValidLineIndex !== -1) {
        // 找到該行的結束位置
        const lineEndIndex = content.indexOf('\n', lastValidLineIndex);
        if (lineEndIndex !== -1) {
            // 截斷到該位置
            content = content.substring(0, lineEndIndex + 1);
        }
    }

    const finalContent = content + analysisContent;

    fs.writeFileSync(targetPath, finalContent, 'utf8');
    console.log('✅ Session 檔案修復並更新成功！');

} catch (error) {
    console.error('❌ 修復失敗:', error);
}
